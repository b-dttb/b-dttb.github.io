<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>写一个本地消息表组件 —— 4. 接入测试</title>
    <link href="/2024/02/16/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-4-%E6%8E%A5%E5%85%A5%E6%B5%8B%E8%AF%95/"/>
    <url>/2024/02/16/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-4-%E6%8E%A5%E5%85%A5%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
    <tags>
      
      <tag>本地消息表</tag>
      
      <tag>分布式事务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>写一个本地消息表组件 —— 3. 失败消息补偿</title>
    <link href="/2024/02/16/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-3-%E5%A4%B1%E8%B4%A5%E6%B6%88%E6%81%AF%E8%A1%A5%E5%81%BF/"/>
    <url>/2024/02/16/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-3-%E5%A4%B1%E8%B4%A5%E6%B6%88%E6%81%AF%E8%A1%A5%E5%81%BF/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
    <tags>
      
      <tag>本地消息表</tag>
      
      <tag>分布式事务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>写一个本地消息表组件 —— 2. 发消息</title>
    <link href="/2024/02/16/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-2-%E5%8F%91%E6%B6%88%E6%81%AF/"/>
    <url>/2024/02/16/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-2-%E5%8F%91%E6%B6%88%E6%81%AF/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
    <tags>
      
      <tag>本地消息表</tag>
      
      <tag>分布式事务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>每年问自己40个问题 —— Obsidian</title>
    <link href="/2024/02/16/%E6%AF%8F%E5%B9%B4%E9%97%AE%E8%87%AA%E5%B7%B140%E4%B8%AA%E9%97%AE%E9%A2%98-Obsidian/"/>
    <url>/2024/02/16/%E6%AF%8F%E5%B9%B4%E9%97%AE%E8%87%AA%E5%B7%B140%E4%B8%AA%E9%97%AE%E9%A2%98-Obsidian/</url>
    
    <content type="html"><![CDATA[<ol><li>你今年做了哪些之前从未做过的事？</li><li>你有没有遵守年初时和自己许下的约定？</li><li>你身边有人生孩子了吗？</li><li>你身边有人去世了吗？</li><li>你去了哪些城市&#x2F;州&#x2F;国家？</li><li>明年你想要获得哪些你今年没有的东西？</li><li>今年的哪个或哪些日子会铭刻在你的记忆中，为什么？</li><li>你今年最大的成就是什么？</li><li>你今年最大的失败是什么？</li><li>你今年还遇到过哪些困难？</li><li>你今年是否生过病或受过伤？</li><li>你今年买过的最好的东西是什么？</li><li>谁的行为值得去表扬？</li><li>谁的行为令你感到震惊？</li><li>你大部分的钱都花到哪里去了？</li><li>有什么事让你感到超级、超级、超级兴奋？</li><li>哪首歌会永远让你想起这一年？</li><li>与去年的这个时候相比，你是：感到更快乐还是更悲伤了？变得更瘦还是更胖了？变得更富还是更穷了？</li><li>你希望自己能做得更多的是什么？</li><li>你希望自己能做得更少的是什么？</li><li>你是如何度过节假日的？</li><li>你今年坠入爱河了吗？</li><li>你是否有讨厌某个你去年此时不觉得讨厌的人呢？</li><li>你最喜欢的电视节目是什么？</li><li>你读过最好的一本书是什么？</li><li>你今年发现的最好听的一首歌是什么？</li><li>你今年看过最喜欢的一部电影是什么？</li><li>你今年吃过最好吃的一顿饭是什么？</li><li>有什么是你想要且得到了的？</li><li>有什么是你想要却没有得到的？</li><li>你生日那天做了什么？</li><li>有什么还未发生的事，如果发生了，会让你的这一年变得无比满足?</li><li>你会如何描述你今年的个人时尚风格？</li><li>是什么让你保持理智？</li><li>你最欣赏哪个名人&#x2F;公众人物？</li><li>哪个政治问题最令你有感而发？</li><li>你想念哪些人？</li><li>在你新认识的人之中，谁是最好的？</li><li>今年你学到了什么宝贵的人生经验？</li><li>能够总结你这一年的一句话是什么？</li></ol><p>来源：</p><ol><li><a href="https://forum.obsidian.md/t/40-questions-to-ask-yourself-every-year/8976">https://forum.obsidian.md/t/40-questions-to-ask-yourself-every-year/8976</a></li><li><a href="https://github.com/kepano/40-questions/blob/master/translations/zh-hans/year.md">https://github.com/kepano/40-questions/blob/master/translations/zh-hans/year.md</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>总结</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>写一个本地消息表组件 —— 1. 写消息表</title>
    <link href="/2024/02/10/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-1-%E5%86%99%E6%B6%88%E6%81%AF%E8%A1%A8/"/>
    <url>/2024/02/10/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-1-%E5%86%99%E6%B6%88%E6%81%AF%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="设计表结构"><a href="#设计表结构" class="headerlink" title="设计表结构"></a>设计表结构</h2><table><thead><tr><th>字段</th><th>注释</th></tr></thead><tbody><tr><td>id</td><td>自增主键</td></tr><tr><td>message_id</td><td>消息唯一标识</td></tr><tr><td>message_key</td><td></td></tr><tr><td>sharding_key</td><td></td></tr><tr><td>topic</td><td>消息的topic</td></tr><tr><td>tag</td><td>消息的tag</td></tr><tr><td>status</td><td>消息发送状态，0-待发送，1-已发送，2-发送失败</td></tr><tr><td>orderly</td><td>是否有序，0-无序，1-有序</td></tr><tr><td>send_time</td><td>发送次数，业务中可以设置最大重试数</td></tr><tr><td>body</td><td>消息体</td></tr><tr><td>create_time</td><td>创建时间</td></tr><tr><td>update_time</td><td>更新时间</td></tr></tbody></table><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
    
    <tags>
      
      <tag>本地消息表</tag>
      
      <tag>分布式事务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>写一个本地消息表组件 —— 0. 理论</title>
    <link href="/2024/01/28/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-0-%E7%90%86%E8%AE%BA/"/>
    <url>/2024/01/28/%E5%86%99%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%E7%BB%84%E4%BB%B6-%E2%80%94%E2%80%94-0-%E7%90%86%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<p>本地消息表是解决分布式事务的一种方式，流程如下：</p><div align=center><img src=https://s2.loli.net/2024/01/28/RTcSzYaMelNqt5p.png alt="本地消息表-vivo实现流程图.png" width=80% /></div><p style="text-align: center; font-size: 12px;">图片来源：vivo博客，https://www.cnblogs.com/vivotech/p/14193523.html</p><p>从图中我们可以看出，本地消息表组件应该包含一下几个方面：</p><ol><li>写消息表</li><li>发送MQ消息</li><li>定期扫描消息表，补发消息</li></ol><p>在我们的业务中该如何使用该组件？</p>]]></content>
    
    
    
    <tags>
      
      <tag>本地消息表</tag>
      
      <tag>分布式事务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RocketMQ消费限流</title>
    <link href="/2024/01/20/RocketMQ%E6%B6%88%E8%B4%B9%E9%99%90%E6%B5%81/"/>
    <url>/2024/01/20/RocketMQ%E6%B6%88%E8%B4%B9%E9%99%90%E6%B5%81/</url>
    
    <content type="html"><![CDATA[<h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><ol><li><p>在RocketMQ中一个topic会有多个messageQueue，如果是分区顺序消息的话RocketMQ保证发送端对于同一个sharding key都发送到一个messageQueue</p></li><li><p>在集群消费模式下，一个topic的某一个messageQueue与consumer是多对一的关系，并不能一对多，即多个消费者不能消费同一个messageQueue的消息</p></li></ol><div align=center><img src=https://s2.loli.net/2024/01/20/CGVpn6KDWZSEPem.png alt="RocketMQ-队列与消费者的关系" width=70% /></div>    <ol start="3"><li>如果要保证消息的顺序性，需要发送端和消费端都采用顺序的方式。反例：以上图为例，若某一个key的消息都发送到queue1中，对于consumer1是采用并发消费的方式的话并不能保证消息的顺序性，对于发送端同理</li></ol><div align=center><img src=https://s2.loli.net/2024/01/20/keMqScfy4JYNZWd.png alt="RocketMQ-生产顺序性和消费顺序性组合" width=80% /></div><h2 id="积压原因"><a href="#积压原因" class="headerlink" title="积压原因"></a>积压原因</h2><p>上游发消息发的是顺序消息，且短时间内可能有大量的消息过来</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol><li>增加队列、增加消费者</li><li>提高消费者机器的配置</li><li>排查消费端的性能问题，比如同步链路过长，锁的滥用等等</li></ol><h2 id="最终采用的方案-对消费端进行限制"><a href="#最终采用的方案-对消费端进行限制" class="headerlink" title="最终采用的方案-对消费端进行限制"></a>最终采用的方案-对消费端进行限制</h2><h3 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SentinelResource(value = &quot;自定义资源名&quot;, </span><br><span class="hljs-meta">                  blockHandler = &quot;handleMsgBlockHandler&quot;, </span><br><span class="hljs-meta">                  entryType = EntryType.IN)</span><br><span class="hljs-keyword">public</span> Action <span class="hljs-title function_">consume</span><span class="hljs-params">(Message message, ConsumeContext context)</span> &#123;<br><span class="hljs-comment">// 消费业务逻辑</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 限流降级</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> Action <span class="hljs-title function_">handleMsgBlockHandler</span><span class="hljs-params">(Message message, ConsumeContext context, BlockException ex)</span> &#123;<br><br>    log.warn(<span class="hljs-string">&quot;trigger sentinel blockHandler, msg:[&#123;&#125;]&quot;</span>, message, ex); <br>    <span class="hljs-keyword">return</span> Action.ReconsumeLater;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="修改消费者线程数"><a href="#修改消费者线程数" class="headerlink" title="修改消费者线程数"></a>修改消费者线程数</h3><h2 id="RocketMQ源码分析"><a href="#RocketMQ源码分析" class="headerlink" title="RocketMQ源码分析"></a>RocketMQ源码分析</h2><div align=center><img src="https://s2.loli.net/2024/01/20/KQNPvkoElcXe5Rj.png" alt="RocketMQ-消费逻辑"></div><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol><li>RocketMQ官方文档 4.x，<a href="https://rocketmq.apache.org/zh/docs/4.x/">https://rocketmq.apache.org/zh/docs/4.x/</a></li><li>RocketMQ官方文档 5.0，<a href="https://rocketmq.apache.org/zh/docs/">https://rocketmq.apache.org/zh/docs/</a></li><li>RocketMQ各种变量约束建议，<a href="https://rocketmq.apache.org/zh/docs/introduction/03limits">https://rocketmq.apache.org/zh/docs/introduction/03limits</a></li><li>阿里云官方文档，<a href="https://help.aliyun.com/zh/apsaramq-for-rocketmq/cloud-message-queue-rocketmq-4-x-series/product-overview">https://help.aliyun.com/zh/apsaramq-for-rocketmq/cloud-message-queue-rocketmq-4-x-series/product-overview</a></li><li>Sentinel源码分析，<a href="https://www.javadoop.com/post/sentinel%EF%BC%8C%E8%AF%A5%E5%8D%9A%E4%B8%BB%E7%9A%84%E5%8D%9A%E5%AE%A2%E9%9D%9E%E5%B8%B8%E5%A5%BD">https://www.javadoop.com/post/sentinel</a></li><li>Sentinel官方文档，<a href="https://sentinelguard.io/zh-cn/docs/introduction.html">https://sentinelguard.io/zh-cn/docs/introduction.html</a></li><li>RocketMQ源码分析，<a href="https://juejin.cn/user/831671752463239/posts">https://juejin.cn/user/831671752463239/posts</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>RocketMQ</tag>
      
      <tag>限流</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
